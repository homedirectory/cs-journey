#lang sicp

(#%require "../stream.scm")
(#%require "../../../helpers.scm")
(#%require "./3.5.4.scm")

;Consider the problem of designing a signal-
;processing system to study the homogeneous second-order
;linear differential equation
;d^2*y/d*t^2 - a * (dy/dt) - by = 0
;The output stream, modeling y, is generated by a network
;that contains a loop. This is because the value of d 2 y/dt 2 de-
;pends upon the values of y and dy/dt and both of these are
;determined by integrating d 2 y/dt 2 . The diagram we would
;like to encode is shown in Figure 3.35. Write a procedure
;solve-2nd that takes as arguments the constants a, b, and
;dt and the initial values y0 and dy 0 for y and dy/dt and generates
;the stream of successive values of y.

;--------------------------------------------------------------------

(define (solve-2nd a b y0 dy0 dt)
  ((lambda ()
     (let (
           (y 1)
           (dy 1)
           (ddy 1)
           )
       (set! y (integral (delay dy) y0 dt))
       (set! dy (integral (delay ddy) dy0 dt))
       (set! ddy (add-streams (scale-stream dy a) (scale-stream y b)))
       y
       )
     ))
  )

; TEST
(define e (solve-2nd 0 1 1 1 0.001))
(define cos (solve-2nd 0 -1 1 0 0.0001)) ; cos pi/3